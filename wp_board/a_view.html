<?
// 레코드 쿼리 //
$query = "SELECT * FROM wp_board WHERE uid='$uid' LIMIT 1";
$result = mysql_query($query);
$obj = mysql_fetch_object($result);

// 레코드 결과 //
$my_subject = $obj->subject;
$my_comment = $obj->comment;
$my_ref = $obj->ref;
$my_signdate = date("Y년 m월 d일 H:i",$obj->signdate);

// 문자열 원상복귀 //
$my_subject = stripslashes($my_subject);
$my_comment = stripslashes($my_comment);

if($auth_class->isEditor($code)){ //에디터 사용여부체크
	// HTML 적용 //
	$my_comment = Html_Change($my_comment);
}else{
	// HTML 적용 //
	$my_comment = Html_Change($my_comment);

	// 출력 여부 //
	if($my_html == 1)
	{
		// HTML 미적용 //
		$my_comment = htmlspecialchars($my_comment);

		// 문자열 개행처리 //
		$my_comment = nl2br($my_comment);
	}
	if($my_html == "2")
	{
		// HTML 적용 //
		$my_comment = $my_comment;
	}
	if($my_html == "3")
	{
		// 문자열 개행처리 //
		$my_comment = nl2br($my_comment);
	}
}

// 검색단어 처리 //
if(!strcmp($keyfield,"subject") && $key)
{
	$my_subject = eregi_replace("($key)", "<font color='#FF0000'>\\1</font>", $my_subject);
}
if(!strcmp($keyfield,"comment") && $key)
{
	$my_comment = eregi_replace("($key)","<font color='#FF0000'>\\1</font>",$my_comment);
}

// 조회수 증가 //
mysql_query("UPDATE wp_board SET ref=ref+1 WHERE uid='$uid'");
?>
<table class="table-global">
<tr>
	<td>
		<table class="tbInput-a">
		<tr>
			<th width="12%">작 성 자</th>
			<td width="38%"><b><?=$obj->name?></b></td>
			<th width="12%">등 록 일</th>
			<td width="38%"><?=$my_signdate?></td>
		</tr>
		<tr>
			<th>제&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;목</th>
			<td colspan="3"><font color="#330066"><b><?=$my_subject?></td>
		</tr>
		<?
		$file_q = "SELECT * FROM wp_file WHERE t_name = '$code' AND t_uid = '$uid' order by uid desc ";
		$f_res = mysql_query($file_q);
		// 첨부 파일 //
		while($f_obj = mysql_fetch_object($f_res))
		{
		?>
		<tr>
			<th>첨부파일</th>
			<td><a href="../wp_object/download.html?code=<?=$code?>&uid=<?=$f_obj->uid?>" hidefocus="true" ><img src="../wp_icon/tip_down.gif" border="0" alt="<?=$obj->real_file?>"></a> <font color="#996600">(<?=$f_obj->real_file?>)</font></td>
			<th>다 운 수</th>
			<td><?=$f_obj->down?> 회</td>
		</tr>
		<?
		}
		?>
		<tr>
			<td colspan="4">
				<?
				// 첨부 파일 //
				if(mysql_num_rows($f_res) > 0)
					mysql_data_seek($f_res,0);
				while($f_obj = mysql_fetch_object($f_res)){
					if($f_obj->real_file){
						// 확장자 분리 //
						$img_view = explode(".",$f_obj->change_file);
						if(in_array(strtolower($img_view[1]),$img_file_type)){ // 이미지 파일이면..
							// 파일 경로 //
							$img_path = "$file_path$f_obj->change_file";

							// 파일 크기 //
							$img_size = getimagesize($img_path);
							if($img_size[0] > $document_width){
								$img = "<img src='$img_path' width='$document_width'>";
							}else{
								$img = "<img src='$img_path' width='$img_size[0]' height='$img_size[1]'>";
							}
							echo "$img <br>";
						}//if
					}//if
				}//for
				?>
			</td>
		<tr>
			<td colspan="4"><?=$my_comment?></td>
		</tr>
		</tr>
		<?
		// 관리자 출력 //
		echo ("
			<tr>
				<td colspan='4'>
					<table width='100%' border='0' cellspacing='0' cellpadding='3' class='border_gray_d'>
					<tr>
						<td class='text_c'>
							&#149; 회원 ID : <a href='../wp_member/a_list.html?keyfield=id&key=$obj->id'><font color='#000000'><u>$obj->id</u></font></a>
							&#149; 접속 IP : <a href='../wp_statics/connect.html?keyfield=ip&key=$obj->ip'>$my_ip</a> &#149; E-Mail : $my_email
						</td>
					</tr>
					</table>
				</td>
			</tr>
		");
		?>
		</table>
	</td>
</tr>
<tr>
	<td>&nbsp;</td>
</tr>
<tr>
	<td align="left">
		<table class="tbInput-a">
		<tr>
			<th width="12%">이 전 글</th>
			<td>
				<?
				// 레코드 쿼리 //
				$next_que = "SELECT uid,subject,secret FROM wp_board WHERE code='$code' AND thread='A' AND uid < $uid ORDER BY thread ASC, uid DESC LIMIT 1";
				$next_val = mysql_query($next_que);
				if(!$next_val)
				{
					Error("QUERY_ERROR");
					exit;
				}
				$next_obj = mysql_fetch_object($next_val);

				// 레코드 결과 //
				if($next_obj->secret == "1"){
					$my_security = "<img src='../wp_icon/key_close.gif' border='0'>";
				} else{
					 $my_security = "";
				}

				// 문자열 원상복귀 //
				$next_subject = stripslashes($next_obj->subject);
				echo ("$my_security<a href='admin.html?$basic_get$add_get&mode=view&uid=$next_obj->uid'>$next_subject</a>");
				?>
			</td>
		</tr>
		<tr>
			<th width="12%">다 음 글</th>
			<td bgcolor="#ffffff">
				<?
				// 레코드 쿼리 //
				$pre_que = "SELECT uid,subject,secret FROM wp_board WHERE code='$code' AND thread='A'AND uid > $uid ORDER BY thread DESC, uid ASC LIMIT 1";
				$pre_val = mysql_query($pre_que);
				if(!$pre_val)
				{
					Error("QUERY_ERROR");
					exit;
				}
				$pre_obj = mysql_fetch_object($pre_val);

				if($pre_obj->secret == "1"){
					$my_security = "<img src='../wp_icon/key_close.gif' border='0'>";
				} else{
					 $my_security = "";
				}

				// 문자열 원상복귀 //
				$pre_subject = stripslashes($pre_obj->subject);
				echo ("$my_security<a href='admin.html?$basic_get$add_get&mode=view&uid=$pre_obj->uid'>$pre_subject</a>");
				?>
			</td>
		</tr>
		</table>
	</td>
</tr>
<tr>
	<td align="center" height="40">
		<table class="tbButton-a">
		<tr>
			<td>
				<a href="<?=$PHP_SELF?>?<?=$basic_get.$add_get?>&mode=modify&uid=<?=$uid?>"><img src="../wp_button/modify.gif" border="0"></a>
				<a href="a_delete.php?<?=$basic_get.$add_get?>&uid=<?=$uid?>&thread=<?=$obj->thread?>&fid=<?=$obj->fid?>" onClick="return confirm('정말 삭제하시겠습니까?')"><img src="../wp_button/delete.gif" border="0"></a>
				 <a href="<?=$PHP_SELF?>?<?=$basic_get.$add_get?>&mode=reply&uid=<?=$uid?>" ><img src='../wp_button/reply.gif' border='0' alt='답변'></a>
			</td>
			<td width="25%" align="right">
				<a href="<?=$PHP_SELF?>?<?=$basic_get.$add_get?>&mode=list"><img src="../wp_button/list.gif" border="0"></a>
			</td>
		</tr>
		</table>
	</td>
</tr>
</table>