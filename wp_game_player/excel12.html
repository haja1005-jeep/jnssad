<?
header("Content-type: application/vnd.ms-excel");
header("Content-Disposition: attachment; filename=전년대비증감표.xls");
header("Content-Description: PHP4 Generated Data");

// Session 시작 //
session_start();

// Mysql 클래스 //
require_once "../wp_library/mysql_class.php";

// DB 생성 //
$Mysql = new Mysql;

// DB 연결 //
$Mysql->Connect();

// Setup 설정 //
require_once "../wp_library/setup.php";

// Paging 클래스 //
require_once "../wp_library/page_class.php";

// Error 함수 //
require_once "../wp_library/check.php";

$my_club_code = array_reverse($wp_club_code); // 지역 코드 역순 정렬

// 현재 경기 UID검색
$gam_que = "SELECT * FROM wp_game_ctrl WHERE uid = '$s_gam_uid' ";
$gam_res = mysql_query($gam_que);
$gam_obj = mysql_fetch_object($gam_res);
$gs_year = substr($gam_obj->f_period,0,4);
$be_year = $gs_year -1;

// 이전 경기 UID검색
$b_gam_que = "SELECT * FROM wp_game_ctrl WHERE uid < '$s_gam_uid' ORDER BY uid DESC limit 1";
$b_gam_res = mysql_query($b_gam_que);
if(mysql_num_rows($b_gam_res) == 0)
{
	$p_gam_uid = 0;
}
else
{
	$b_gam_obj = mysql_fetch_object($b_gam_res);
	$p_gam_uid = $b_gam_obj->uid;
}

?>
<body>
<table width="100%" border="1" cellpadding="0" cellspacing="0">
<tr>
	<th rowspan="2">구 분</th>
	<th colspan="3">총 계</th>
	<th colspan="3">임원 총계</th>
	<th colspan="3">선수 총계</th>
	<?
	foreach($wp_game_code as $key_f => $val_f)
	{
		echo "<th colspan='3'>$val_f</th>";
	}
	?>
	<th colspan="3">휠체어선수</th>
</tr>
<tr>
	<?
	for($i = 0 ; $i < 24 ; $i++)
	{
		echo "<th>".$be_year."년</th><th>".$gs_year."년</th><th>증감△</th>";
	}
	?>
</tr>
<tr>
	<th>계</th>

	<?
	// 총계 //
	$tot_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$s_gam_uid'";
	$tot_res = mysql_query($tot_que);
	$tot_obj = mysql_fetch_object($tot_res);

	$post_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$p_gam_uid'";
	$post_res = mysql_query($post_que);
	$post_obj = mysql_fetch_object($post_res);

	unset($my_math);
	$my_math = $tot_obj->a_cnt - $post_obj->a_cnt;
	if($tot_obj->a_cnt > $post_obj->a_cnt)
	{
		$my_math = "<font color='blue'>▲".$my_math."</font>";
	}
	if($tot_obj->a_cnt < $post_obj->a_cnt)
	{
		$my_math = "<font color='red'>".$my_math."</font>";
	}

	echo "<td>$post_obj->a_cnt</td>";
	echo "<td>$tot_obj->a_cnt</td>";
	echo "<td align='right'>$my_math</td>";

	// 임원 총계 //
	$tot_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$s_gam_uid' AND kubun <> '9'";
	$tot_res = mysql_query($tot_que);
	$tot_obj = mysql_fetch_object($tot_res);

	$post_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$p_gam_uid' AND kubun <> '9'";
	$post_res = mysql_query($post_que);
	$post_obj = mysql_fetch_object($post_res);

	unset($my_math);
	$my_math = $tot_obj->a_cnt - $post_obj->a_cnt;
	if($tot_obj->a_cnt > $post_obj->a_cnt)
	{
		$my_math = "<font color='blue'>▲".$my_math."</font>";
	}
	if($tot_obj->a_cnt < $post_obj->a_cnt)
	{
		$my_math = "<font color='red'>".$my_math."</font>";
	}


	echo "<td>$post_obj->a_cnt</td>";
	echo "<td>$tot_obj->a_cnt</td>";
	echo "<td align='right'>$my_math</td>";

	// 선수 총계 //
	$tot_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$s_gam_uid' AND kubun = '9'";
	$tot_res = mysql_query($tot_que);
	$tot_obj = mysql_fetch_object($tot_res);

	$post_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$p_gam_uid' AND kubun = '9'";
	$post_res = mysql_query($post_que);
	$post_obj = mysql_fetch_object($post_res);

	unset($my_math);
	$my_math = $tot_obj->a_cnt - $post_obj->a_cnt;
	if($tot_obj->a_cnt > $post_obj->a_cnt)
	{
		$my_math = "<font color='blue'>▲".$my_math."</font>";
	}
	if($tot_obj->a_cnt < $post_obj->a_cnt)
	{
		$my_math = "<font color='red'>".$my_math."</font>";
	}


	echo "<td>$post_obj->a_cnt</td>";
	echo "<td>$tot_obj->a_cnt</td>";
	echo "<td align='right'>$my_math</td>";

	// 경기별 총계 //
	foreach($wp_game_code as $key_f => $val_f)
	{
		$tot_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$s_gam_uid' AND spo_code = '$key_f'";
		$tot_res = mysql_query($tot_que);
		$tot_obj = mysql_fetch_object($tot_res);

		$post_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$p_gam_uid' AND spo_code = '$key_f'";
		$post_res = mysql_query($post_que);
		$post_obj = mysql_fetch_object($post_res);

		unset($my_math);
		$my_math = $tot_obj->a_cnt - $post_obj->a_cnt;
		if($tot_obj->a_cnt > $post_obj->a_cnt)
		{
			$my_math = "<font color='blue'>▲".$my_math."</font>";
		}
		if($tot_obj->a_cnt < $post_obj->a_cnt)
		{
			$my_math = "<font color='red'>".$my_math."</font>";
		}


		echo "<td>$post_obj->a_cnt</td>";
		echo "<td>$tot_obj->a_cnt</td>";
		echo "<td align='right'>$my_math</td>";
	}

	// 휠체어 인원 //
	$tot_que = "SELECT count(DISTINCT wgp.pla_id) as a_cnt FROM wp_game_player wgp, wp_player_ctrl wpc WHERE wgp.pla_id = wpc.wp_id AND wpc.wheel = '0' AND wgp.gam_uid = '$s_gam_uid'";
	$tot_res = mysql_query($tot_que);
	$tot_obj = mysql_fetch_object($tot_res);

	$post_que = "SELECT count(DISTINCT wgp.pla_id) as a_cnt FROM wp_game_player wgp, wp_player_ctrl wpc WHERE wgp.pla_id = wpc.wp_id AND wpc.wheel = '0' AND wgp.gam_uid = '$p_gam_uid'";
	$post_res = mysql_query($post_que);
	$post_obj = mysql_fetch_object($post_res);

	unset($my_math);
	$my_math = $tot_obj->a_cnt - $post_obj->a_cnt;
	if($tot_obj->a_cnt > $post_obj->a_cnt)
	{
		$my_math = "<font color='blue'>▲".$my_math."</font>";
	}
	if($tot_obj->a_cnt < $post_obj->a_cnt)
	{
		$my_math = "<font color='red'>".$my_math."</font>";
	}


	echo "<td>$post_obj->a_cnt</td>";
	echo "<td>$tot_obj->a_cnt</td>";
	echo "<td align='right'>$my_math</td>";
	?>
</tr>
<?
foreach($my_club_code as $key_f => $val_f)
{
	if($key_f == "jnsad" || $key_f == "WEBPLUS") continue;
	echo "<tr>";

	// 시/군 //
	echo "<td align='center'>$val_f</td>";


	// 총계 //
	$tot_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$s_gam_uid' AND clu_code = '$key_f'";
	$tot_res = mysql_query($tot_que);
	$tot_obj = mysql_fetch_object($tot_res);

	$post_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$p_gam_uid' AND clu_code = '$key_f'";
	$post_res = mysql_query($post_que);
	$post_obj = mysql_fetch_object($post_res);

	unset($my_math);
	$my_math = $tot_obj->a_cnt - $post_obj->a_cnt;
	if($tot_obj->a_cnt > $post_obj->a_cnt)
	{
		$my_math = "<font color='blue'>▲".$my_math."</font>";
	}
	if($tot_obj->a_cnt < $post_obj->a_cnt)
	{
		$my_math = "<font color='red'>".$my_math."</font>";
	}


	echo "<td>$post_obj->a_cnt</td>";
	echo "<td>$tot_obj->a_cnt</td>";
	echo "<td align='right'>$my_math</td>";


	// 임원 총계 //
	$tot_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$s_gam_uid' AND kubun <> '9' AND clu_code = '$key_f'";
	$tot_res = mysql_query($tot_que);
	$tot_obj = mysql_fetch_object($tot_res);

	$post_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$p_gam_uid' AND kubun <> '9' AND clu_code = '$key_f'";
	$post_res = mysql_query($post_que);
	$post_obj = mysql_fetch_object($post_res);

	unset($my_math);
	$my_math = $tot_obj->a_cnt - $post_obj->a_cnt;
	if($tot_obj->a_cnt > $post_obj->a_cnt)
	{
		$my_math = "<font color='blue'>▲".$my_math."</font>";
	}
	if($tot_obj->a_cnt < $post_obj->a_cnt)
	{
		$my_math = "<font color='red'>".$my_math."</font>";
	}


	echo "<td>$post_obj->a_cnt</td>";
	echo "<td>$tot_obj->a_cnt</td>";
	echo "<td align='right'>$my_math</td>";


	// 선수 총계 //
	$tot_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$s_gam_uid' AND kubun = '9' AND clu_code = '$key_f'";
	$tot_res = mysql_query($tot_que);
	$tot_obj = mysql_fetch_object($tot_res);

	$post_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$p_gam_uid' AND kubun = '9' AND clu_code = '$key_f'";
	$post_res = mysql_query($post_que);
	$post_obj = mysql_fetch_object($post_res);

	unset($my_math);
	$my_math = $tot_obj->a_cnt - $post_obj->a_cnt;
	if($tot_obj->a_cnt > $post_obj->a_cnt)
	{
		$my_math = "<font color='blue'>▲".$my_math."</font>";
	}
	if($tot_obj->a_cnt < $post_obj->a_cnt)
	{
		$my_math = "<font color='red'>".$my_math."</font>";
	}


	echo "<td>$post_obj->a_cnt</td>";
	echo "<td>$tot_obj->a_cnt</td>";
	echo "<td align='right'>$my_math</td>";

	// 종목별 총계 //
	foreach($wp_game_code as $key_g => $val_g)
	{
		unset($my_math);
		$tot_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$s_gam_uid' AND spo_code = '$key_g' AND clu_code = '$key_f'";
		$tot_res = mysql_query($tot_que);
		$tot_obj = mysql_fetch_object($tot_res);

		$post_que = "SELECT COUNT(DISTINCT pla_id) as a_cnt FROM wp_game_player WHERE gam_uid = '$p_gam_uid' AND spo_code = '$key_g' AND clu_code = '$key_f'";
		$post_res = mysql_query($post_que);
		$post_obj = mysql_fetch_object($post_res);

		$my_math = $tot_obj->a_cnt - $post_obj->a_cnt;
		if($tot_obj->a_cnt > $post_obj->a_cnt)
		{
			$my_math = "<font color='blue'>▲".$my_math."</font>";
		}
		if($tot_obj->a_cnt < $post_obj->a_cnt)
		{
			$my_math = "<font color='red'>".$my_math."</font>";
		}


		echo "<td>$post_obj->a_cnt</td>"; // 2010 //
		echo "<td>$tot_obj->a_cnt</td>"; // 2011 //
		echo "<td align='right'>$my_math</td>"; // 증감 //
	}

	unset($my_math);
	// 휠체어 인원 //
	$tot_que = "SELECT count(DISTINCT wgp.pla_id) as a_cnt FROM wp_game_player wgp, wp_player_ctrl wpc WHERE wgp.pla_id = wpc.wp_id AND wpc.wheel = '0' AND wgp.gam_uid = '$s_gam_uid' AND wgp.clu_code = '$key_f'";
	$tot_res = mysql_query($tot_que);
	$tot_obj = mysql_fetch_object($tot_res);

	$post_que = "SELECT count(DISTINCT wgp.pla_id) as a_cnt FROM wp_game_player wgp, wp_player_ctrl wpc WHERE wgp.pla_id = wpc.wp_id AND wpc.wheel = '0' AND wgp.gam_uid = '$p_gam_uid' AND wgp.clu_code = '$key_f'";
	$post_res = mysql_query($post_que);
	$post_obj = mysql_fetch_object($post_res);

	$my_math = $tot_obj->a_cnt - $post_obj->a_cnt;
	if($tot_obj->a_cnt > $post_obj->a_cnt)
	{
		$my_math = "<font color='blue'>▲".$my_math."</font>";
	}
	if($tot_obj->a_cnt < $post_obj->a_cnt)
	{
		$my_math = "<font color='red'>".$my_math."</font>";
	}



	echo "<td>$post_obj->a_cnt</td>"; // 2010 //
	echo "<td>$tot_obj->a_cnt</td>"; // 2011 //
	echo "<td align='right'>$my_math</td>"; // 증감 //

	echo "</tr>";
}
?>
</table>
</body>