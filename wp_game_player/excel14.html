<?
header( "Content-type: application/vnd.ms-excel; charset=euc-kr");
header( "Content-Disposition: attachment; filename=연령대별총계표.xls" );
header( "Content-Description: PHP4 Generated Data" );
print("<meta http-equiv=\"Content-Type\" content=\"application/vnd.ms-excel; charset=euc-kr\">");

// Mysql 클래스 //
require_once "../wp_library/mysql_class.php";
// DB 생성 //
$Mysql = new Mysql;
// DB 연결 //
$Mysql->Connect();

// Setup 설정 //
require_once "../wp_library/setup.php";

// Paging 클래스 //
require_once "../wp_library/page_class.php";

// Error 함수 //
require_once "../wp_library/check.php";
?>
<body>
<?
	$query = "SELECT spo_code, (SELECT sex FROM wp_player_ctrl WHERE wp_id = wgp.pla_id) r_sex, (SELECT birthday FROM wp_player_ctrl WHERE wp_id = wgp.pla_id) birthday FROM wp_game_player wgp WHERE gam_uid = '$s_gam_uid' ORDER BY spo_code, r_sex";
	$result = mysql_query($query);

	$spo_arr = array();
	$b_spo_code = "";

	$tro_code_cnt = 0;
	while($obj = mysql_fetch_object($result)){
		if($obj->spo_code != $b_spo_code)
		{
			$spo_arr[$b_spo_code] = $tmp_arr;
			$tro_code_cnt = 0;
			$tmp_arr = array();
		};

		$my_birth = explode("-",$obj->birthday);
		$my_age = 2012 - $my_birth[0];

		if($my_age < 20 && $my_age >= 10) $age_type = 10;
		else if($my_age < 30 && $my_age >= 20) $age_type = 20;
		else if($my_age < 40 && $my_age >= 30) $age_type = 30;
		else if($my_age < 50 && $my_age >= 40) $age_type = 40;
		else if($my_age < 60 && $my_age >= 50) $age_type = 50;
		else if($my_age >= 60) $age_type = 60;

		$keys = $age_type."/".$obj->r_sex;
		$tmp_arr["$keys"] = $tmp_arr["$keys"] + 1;

		$b_spo_code = $obj->spo_code;
	}
	$spo_arr[$b_spo_code] = $tmp_arr;
?>
	<table border="1" cellpadding="0" cellspacing="0" style="font-size:0.8em">
	<tr>
		<td colspan= "13" height="50" align="center"><font size="4"><b><?=$wp_games[$s_gam_uid]?> 참가자 [연령대별 총계표]</b></font></td>
	</tr>
	<tr align="center">
		<td rowspan="2"><b>구분</b></td>
		<td colspan="2"><b>10대</b></td>
		<td colspan="2"><b>20대</b></td>
		<td colspan="2"><b>30대</b></td>
		<td colspan="2"><b>40대</b></td>
		<td colspan="2"><b>50대</b></td>
		<td colspan="2"><b>60대 이상</b></td>
	</tr>
	<tr>
		<td align="center"><b>남</b></td>
		<td align="center"><b>여</b></td>
		<td align="center"><b>남</b></td>
		<td align="center"><b>여</b></td>
		<td align="center"><b>남</b></td>
		<td align="center"><b>여</b></td>
		<td align="center"><b>남</b></td>
		<td align="center"><b>여</b></td>
		<td align="center"><b>남</b></td>
		<td align="center"><b>여</b></td>
		<td align="center"><b>남</b></td>
		<td align="center"><b>여</b></td>
	</tr>
	<?
	$spo_data = $spo_arr[""];
	$etc_cnt =  $spo_data["/male"] + $spo_data["/female"];

	foreach($wp_game_code as $key_f => $val_f)
	{
		$spo_data = $spo_arr["$key_f"];
		echo "
			<tr>
				<td height='30' align='center'>$val_f</td>
				<td>".$spo_data["10/male"]."</td>
				<td>".$spo_data["10/female"]."</td>
				<td>".$spo_data["20_2/male"]."</td>
				<td>".$spo_data["20_2/female"]."</td>
				<td>".$spo_data["30/male"]."</td>
				<td>".$spo_data["30/female"]."</td>
				<td>".$spo_data["40/male"]."</td>
				<td>".$spo_data["40/female"]."</td>
				<td>".$spo_data["50/male"]."</td>
				<td>".$spo_data["50/female"]."</td>
				<td>".$spo_data["60/male"]."</td>
				<td>".$spo_data["60/female"]."</td>
			</tr>
		";
	}
	?>
	</table>
</body>