<?
if(!$s_gam_uid) $s_gam_uid = $gam_uid;
?>
<script type="text/javascript">
window.onload = function(){
	preloadForm3();
}
</script>
<form name="sForm" action="index.html?mode=list#list" method="post" onSubmit="return validate(this)">
<input type="hidden" name="gam_uid" value="<?=$s_gam_uid?>">
<!-- 선수 검색 시작 -->
<a name="list">
<table class="table-global">
<tr>
	<td>
		<fieldset class="help_wrap">
			<legend>도움말</legend>
			<ul class="help_body">
				<li>
					정렬순서란? 검색 후 하단에 선수정보 리스트를 출력할 때 정렬할 순서를 나타냅니다.
					<br>
					출력순서 미지정시 <font color="#cc0000"><b>1:선수구분, 2:성명순, 3:성별순, 4:장애유형  </b></font>으로 정렬하여 출력
				</li>
			</ul>
		</fieldset>
	</td>
</tr>
<tr>
	<td>
		<table class="tbSearch-c">
		<tr>
			<td>
				<table cellpadding="0" cellspacing="0" border="0" class="border_gray_e">
				<tr>
					<th width="15%">정렬순서</th>
					<td align="left" colspan="3">
						1순위
						<select name="orderby1" hname="출력순">
							<option value="">--선택-- </option>
							<?
								foreach($wp_orderby_code as $keys => $values){
									if($keys == $orderby1)
										$is_selected = " selected ";
									else $is_selected = "";
									echo "<option value='$keys' $is_selected>$values</option>";
								}
							?>
						</select>,
						2순위
						<select name="orderby2" hname="출력순">
							<option value="">--선택-- </option>
							<?
								foreach($wp_orderby_code as $keys => $values){
									if($keys == $orderby2)
										$is_selected = " selected ";
									else $is_selected = "";
									echo "<option value='$keys' $is_selected>$values</option>";
								}
							?>
						</select>,
						3순위
						<select name="orderby3" hname="출력순">
							<option value="">--선택-- </option>
							<?
								foreach($wp_orderby_code as $keys => $values){
									if($keys == $orderby3)
										$is_selected = " selected ";
									else $is_selected = "";
									echo "<option value='$keys' $is_selected>$values</option>";
								}
							?>
						</select>,
						4순위
						<select name="orderby4" hname="출력순">
							<option value="">--선택-- </option>
							<?
								foreach($wp_orderby_code as $keys => $values){
									if($keys == $orderby4)
										$is_selected = " selected ";
									else $is_selected = "";
									echo "<option value='$keys' $is_selected>$values</option>";
								}
							?>
						</select>
					</td>
				</tr>
				<tr>
					<th rowspan="3">검색조건</th>
					<td>
						<select name="s_gam_uid" tabindex="1" hname="대회선택" required>
							<option value="">--선택-- </option>
							<?
								foreach($wp_games as $keys => $values){
									if($keys == $s_gam_uid)
										$is_selected = " selected";
									else $is_selected = "";
									echo "<option value='$keys' $is_selected>$values</option>";
								}
							?>
						</select>
						<?
						//시/군구 이면 자기 데이터 출력
						if($Admin_auth == "normal" || $Admin_auth == "sponsor") {
							echo "<input type='hidden' name='clu_code' hname='대회주최기관' value='$Admin_code'>";
						 }else{
							echo "
							<select name='clu_code' tabindex='1' hname='소속시도'>
								<option value=''>-시/군선택-</option>
							";
								foreach($wp_club_code as $keys => $values){
									if($keys == $clu_code) $is_selected = " selected";
									else $is_selected = "";
									echo "<option value='$keys' $is_selected>$values</option>";
								}
							echo "</select>";
						}
						?>
						<?
						// 경기단체(경기종목)//
						if($Admin_auth == "s_group")
						{
							$my_s_arr = explode("team",$Site_Admin);
							$spo_code = $my_s_arr[1];

							$my_s_fixed = "disabled";
						 }

						echo "
						<select name='spo_code' tabindex='2' hname='경기종목' onchange='Sports_Sec_Code(this.form,1)' $my_s_fixed>
							<option value=''>-경기종목-</option>
						";
						foreach($wp_sports_code as $keys => $values){
							if($keys == $spo_code)
								$is_selected = " selected ";
							else $is_selected = "";
							echo "<option value='$keys' $is_selected>$values</option>";
						}
						echo "</select>";
						?>
						<script id="sports_sec_code"></script>
						<!-- 히든으로 가지고 있어야할 필수항목..-->
						<input type="hidden" name="h_spo_sec_code" value="<?=$spo_sec_code?>">
						<select name="spo_sec_code" tabindex="2" hname="2차종목" onchange="Trouble_Code(this.form)">
							<option value="">--2차종목-- </option>
						</select>
						<script id="trouble_code"></script>
						<!-- 히든으로 가지고 있어야할 필수항목..-->
						<input type="hidden" name="h_tro_code" value="<?=$tro_code?>">
						<select name="tro_code" tabindex="3" hname="장애유형" onchange="Sports_Detail3(this.form,1)">
							<option value="">--장애유형-- </option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						<select name="kubun" tabindex="2" hname="선수구분">
							<option value="">--선수구분-- </option>
							<?
								foreach($wp_kubun_code as $keys => $values){
									if($keys == $kubun)
										$is_selected = " selected ";
									else $is_selected = "";
									echo "<option value='$keys' $is_selected>$values</option>";
								}
							?>
						</select>
						<select name="sex" tabindex="4" hname="성별" onChange="Sports_Detail3(this.form,1)">
							<option value="">--성별-- </option>
							<?
								foreach($wp_sex_code as $keys => $values){
									if($keys == $sex)
										$is_selected = " selected";
									else $is_selected = "";
									echo "<option value='$keys' $is_selected>$values</option>";
								}
							?>
						</select>
						<script id="sports_code_detail1"></script>
						<!-- 히든으로 가지고 있어야할 필수항목..-->
						<input type="hidden" name="h_tro_level_code" value="<?=$tro_level_code?>">
						<select name="tro_level_code" tabindex="5" hname="스포츠장애등급" onChange="Sports_Detail3(this.form,2)">
							<option value="">--스포츠장애등급-- </option>
						</select>
						<script id="sports_code_detail2"></script>
						<!-- 히든으로 가지고 있어야할 필수항목..-->
						<input type="hidden" name="h_spo_code_detail" value="<?=$spo_code_detail?>">
						<select name="spo_code_detail" tabindex="6" hname="경기세부종목" >
							<option value="">--경기세부종목-- </option>
						</select>
						<select name="keyfield">
							<option value="pla_name">성 명</option>
						</select>
						<input type="text" size="15" maxlength="30" name="key">
						<input type="button" name="sch" value="검색하기" tabindex="8" class="btnBox3" onclick="this.form.submit()">
					</td>
				</tr>
				</table>
			</td>
		</tr>
		</table>
	</td>
</tr>
<tr>
	<td>
		<table class="tbButton-a">
		<tr>
			<td>
				<?
				if($Admin_auth == "user"){
					echo "<input type='button' name='input' value='대회참가취소' class='btnBox3' onclick=\"funcPlayerDelete(this.form)\">";
				}
				?>
				<input type="button" name="send" value="목록으로" class="btn_send" onclick="location.href='index.html?<?=$basic_get.$add_get?>&gam_uid=<?=$s_gam_uid?>'">
			</td>
		</tr>
		</table>
	</td>
</tr>

<tr>
	<td>
		<!-- 선수검색 끝 -->
		<table class="tbList-a">
		<tbody>
		<tr>
			<th width="3%"><input type="checkbox" name="chk" value="pla_id" onClick="selectAll(this.form,this.value)"></th>
			<th width="5%">번호</th>
			<th width="9%">시/군</th>
			<th width="6%">구분</th>
			<th width="7%">선수명</th>
			<th width="5%">성별</th>
			<th width="17%">주민번호</th>
			<th width="15%">장애유형</th>
			<th>참가종목</th>
			<th width="5%">신청수정</th>
			<th width="5%">선수정보</th>
		</tr>
		<?
		//LIMIT절 생성
		if(!$page) $page=1;
		$offset = ($page - 1) * $max_record;
		$limit = $max_record;

		//ORDER BY절 생성
		if($orderby1 == "name") $orderby1 = "pla_name";
		if($orderby2 == "name") $orderby2 = "pla_name";
		if($orderby3 == "name") $orderby3 = "pla_name";
		if($orderby4 == "name") $orderby4 = "pla_name";
		//출력순
		if(!$orderby1 && !$orderby2 && !$orderby3 && !$orderby4)
			$orderby .= " clu_code ASC, kubun ASC, spo_code ASC, spo_sec_code ASC, spo_code_detail ASC, pla_name ASC,tro_code ASC, tro_level_code ASC,";
		if($orderby1)
			$orderby .= " $orderby1 ASC, ";
		if($orderby2)
			$orderby .= " $orderby2 ASC, ";
		if($orderby3)
			$orderby .= " $orderby3 ASC, ";
		if($orderby4)
			$orderby .= " $orderby4 ASC, ";
		$orderby .= " uid desc ";

		//해당 시/군의 데이터만 확인가능
		//WHERE절 생성 //
		if($Admin_auth == "top" || $Admin_auth == "s_group"){
			$where = " WHERE gam_uid = '$s_gam_uid'";
		} else{
			$where = " WHERE gam_uid = '$s_gam_uid'";
			$clu_code = $Admin_code;
		}

		//시/군이 있으면
		if($clu_code) $where .= " AND clu_code = '$clu_code'";
		if($clu_code == "testsad") $where = str_replace(" AND clu_code = '$clu_code'","",$where);

		//경기종목가있으면
		if($spo_code) $where .= " AND spo_code = '$spo_code' ";
		//경기2차종목가있으면 - 2017년 2차종목 미입력으로 주석 처리 함
		//if($spo_sec_code) $where .= " AND spo_sec_code = '$spo_sec_code' ";
		//선수구분
		if($kubun) $where .= " AND kubun= '$kubun' ";
		//장애유형 가있으면
		if($tro_code) $where .= " AND tro_code = '$tro_code' ";
		//장애세부유형 가있으면
		if($tro_level_code) $where .= " AND tro_level_code = '$tro_level_code' ";
		//성별 가있으면
		if($sex) $where .= " AND sex = '$sex' ";
		//경기세부종목가있으면
		if($spo_code_detail) $where .= " AND spo_code_detail = '$spo_code_detail' ";





		if(eregi("[^[:space:]]+",$key))
			$Q_key = " AND  $keyfield LIKE '%$key%' ";
		$where .= $Q_key;

		// 레코드 쿼리 //
		$query = "SELECT *, (SELECT sex p_sex FROM wp_player_ctrl WHERE wp_id = wgp.pla_id) p_sex,
						(SELECT concat(jumin1,'-',jumin2) jumin FROM wp_player_ctrl WHERE wp_id = wgp.pla_id) jumin,
						group_concat(spo_sec_code order by spo_sec_code asc separator '|') spo_sec_code,
                        group_concat(tro_level_code order by spo_code_detail asc separator '|') tro_level_codes,
						group_concat(spo_code_detail order by spo_code_detail asc separator '|') spo_code_details,
						group_concat(uid order by spo_code_detail asc separator '|') pla_uids				 
				   FROM wp_game_player wgp
				 $where GROUP BY pla_id,spo_code ORDER BY $orderby LIMIT $offset, $limit";
		$result = mysql_query($query);
	

		if(!$result)
		{
			Error("QUERY_ERROR");
			exit;
		}

		// 총 레코드 수 //
		$total_record  = $Mysql->getTotalRecord("wp_game_player wgp", $where); //세부종목 신청까지 카운팅 됨
		$total_record2 = $Mysql->getTotalRecord2("wp_game_player wgp", $where); //2017.03.10. 11시30분 추가. 카운터 오류 $total_record->$total_record2

		//$total_record2 = $total_record2 + 2;

		
		// 페이지 목록 //
		$PageNumber = new PageNumber($total_record2,$max_record,$max_page,$page);

		// 일련 번호 //
		$article_num = $total_record2 - $max_record*($PageNumber->page-1);

		// 레코드 결과 //
		for($i=0;$i<mysql_num_rows($result);$i++)
		{

			$obj = mysql_fetch_object($result);

			$my_pla_name = $obj->pla_name;
			// 검색단어 처리 //
			if(!strcmp($keyfield,"pla_name") && $key)
			{
				$my_pla_name = eregi_replace("($key)", "<font color='#FF0000'>\\1</font>", $my_pla_name);
			}

			if($obj->isuse == "1")
			{
				$bgcolor = "bgcolor='#e7944a' ";
			}
			else
			{
				$bgcolor = "";
			}
			if($obj->tro_level_code)
				$my_trouble_code = getTrouble_level_code($obj->spo_code, $obj->tro_level_code)."(".$obj->tro_level_code.")";
			else $my_trouble_code = "";

		?>
		<input type="hidden" name="uid[]" value="<?=$obj->uid?>">
		<tr <?=$bgcolor?>>
			<td align="center"><input type="checkbox" name="pla_id[]" value="<?=$obj->pla_id?>"></td>
			<td align="center"><?=$article_num?></td>
			<td align="center"><?=$wp_club_code[$obj->clu_code]?></td>
			<td align="center"><?=$wp_kubun_code[$obj->kubun]?></td>
			<td align="center"><?=$my_pla_name?></td>
			<td align="center"><?=$wp_sex_code[$obj->p_sex]?></td>
			<td align="center">
				<?
				if($Admin_auth == "top")
				{
					echo $obj->jumin;
				}
				else
				{
					$my_jumin_arr = explode("-",$obj->jumin);
					$my_ju = substr($my_jumin_arr[1],0,1);
					echo $my_jumin_arr[0]."-".$my_ju."******";
					//echo $my_jumin_arr[0]."-".$my_jumin_arr[1];
				}
				?>
			</td>
			<td align="center"><?=$wp_trouble_code[$obj->tro_code]?></td>
			<td align="left">
				<?
				$ii = "";
				$ll = 1;

				if($obj->kubun == $wp_kubun_선수){

				
					
					$sec  = explode("|",$obj->spo_sec_code);					
					$scd  = explode("|",$obj->spo_code_details);
					$uids = explode("|",$obj->pla_uids);
					$tlc  = explode("|",$obj->tro_level_codes);
					
					if($obj->spo_code == "POWERLIFTING")
					{

                        //echo $obj->spo_sec_code;
						echo "<span class='title'>{$wp_sports_code[$obj->spo_code]}</span></br>";

						if($obj->spo_sec_code == "PL100|PL200|PL300")
						{
							echo "- 벤치프레스종합 ";
						}
						else
						{
							echo "- 파워리프트종합 ";
						}
						//echo "<br>";

						$b_vals = "";

							$ii = count($scd);
							$lastdot = "|";

						foreach($scd as $keys => $vals){

						if($ii == $ll) $lastdot = " ";

						
							$p_uid = $uids[$keys];
							if($b_vals == $vals) continue;
							if($Admin_auth != "user" && $Admin_auth != "s_group")
							{
							
								// 관리자만 삭제를 할 수 있다. //
								if($Admin_auth == "top")
								{
									echo "<span class='color02'>".$wp_sports_detail_code[$vals]."</span> <a href='./delete.php?pla_id=$obj->pla_id&spo_code=$obj->spo_code&spo_sec_code=$obj->spo_sec_code&spo_code_detail=$obj->spo_code_detail&type=gpdel' onclick=\" return confirm('정말 취소하시겠습니까?')\"><img src='../wp_button/s_delete.gif' width='13' height='15' align='absmiddle'></a> {$lastdot} ";
								}
								else
								{
									echo "<span class='color02'>".$wp_sports_detail_code[$vals]."</span> {$lastdot} ";
								}
                               
                                
								 	   // 시군에서도 삭제 할 수 있게. 2019년부터 //  경기신청 후 주석처리 
                                    /*
									//echo "<span class='color02'>".$wp_sports_detail_code[$vals]."</span> <a href='./delete.php?pla_id=$obj->pla_id&spo_code=$obj->spo_code&spo_sec_code=$obj->spo_sec_code&spo_code_detail=$obj->spo_code_detail&type=gpdel' //onclick=\" return confirm('정말 취소하시겠습니까?')\"><img src='../wp_button/s_delete.gif' width='13' height='15' align='absmiddle'></a> {$lastdot} ";

                                    */


							}
							$b_vals = $vals;
							$ll++;
						}
					}else{
						

						echo "<span class='title'>{$wp_sports_code[$obj->spo_code]}</span></br>";

						$ii = count($scd);
						$lastdot = "|";


						if($wp_sports_code[$obj->spo_code] != getSpo_sec_code($obj->spo_code,$obj->spo_sec_code))
						{
							echo "- ".getSpo_sec_code($obj->spo_code,$sec[0])." ";
						}
						//echo "| <span class='color01'>{$my_trouble_code}</span>";
						
						
						$spo_sec_code = $sec[0];

						foreach($scd as $keys => $vals){
							$p_uid = $uids[$keys];

							if($ii == $ll) $lastdot = " ";

								if($spo_sec_code == $sec[$ll-1]) {
								
							
								}else{

							

                                if($ii > 2)
								{
								 $spo_sec_code = $sec[$ll];
                                } else {
                                 $spo_sec_code = $sec[$ll-1];
								}
								echo "</br>";

						            if($wp_sports_code[$obj->spo_code] != getSpo_sec_code($obj->spo_code,$obj->spo_sec_code))
						             {
							          echo "- ".getSpo_sec_code($obj->spo_code,$spo_sec_code)." ";
						             }

							  
				                
                                }

                                $spo_sec_code = $sec[$ll-1];


							if($Admin_auth != "user" || $Admin_auth != "s_group")
							{
								$group_str = $obj->group_str;
								if($group_str) $group_str = "(".$group_str."팀)";
								
								
								// 관리자만 삭제를 할 수 있다. //
								if($Admin_auth == "top")
								{
									echo "<span class='color01'>".$tlc[$keys]."</span>-<span class='color02'>".$wp_sports_detail_code[$vals].$group_str."</span> <a href='./delete.php?$basic_get$add_get&uid=$p_uid&type=gpdel' onclick=\" return confirm('정말 취소하시겠습니까?')\"><img src='../wp_button/s_delete.gif' width='13' height='15' align='absmiddle'></a> {$lastdot} ";
								}
								else
								{
                                
								    // 시군 관리자도 삭제 가능 2019년부터 //
									echo "<span class='color01'>".$tlc[$keys]."</span>-<span class='color02'>".$wp_sports_detail_code[$vals]."</span> {$lastdot} ";

									/*echo "<span class='color01'>".$tlc[$keys]."</span>-<span class='color02'>".$wp_sports_detail_code[$vals].$group_str."</span> <a href='./delete.php?$basic_get$add_get&uid=$p_uid&type=gpdel' onclick=\" return confirm('정말 취소하시겠습니까?')\"><img src='../wp_button/s_delete.gif' width='13' height='15' align='absmiddle'></a> {$lastdot} ";*/
								}





								$group_str = "";
							}

							$ll++;
						}
					}
				}else if($obj->kubun == $wp_kubun_종목인솔자 || $obj->kubun == $wp_kubun_감독 || $obj->kubun == $wp_kubun_코치){
					echo $wp_sports_code[$obj->spo_code];
					if($my_trouble_code) echo "| $my_trouble_code <br>";
				}
				?>
			</td>
			<td align="center"><!-- 2018.02.19 일시정지
				<?
				if($Admin_auth != "user" && $obj->kubun == $wp_kubun_선수)
				{
				?>
				<span align="center"><div class='btWwhite_s'><a href="#none" onclick="window.open('modify_2017.html?pla_id=<?=$obj->pla_id?>&type=pop','player','width=1400,height=800,scrollbars=yes');"><span style="font-size:8pt;">신청수정</span></a></div></span>
				<?
				}
				?>-->
			</td>
			<td align="center">
				<?
				if($Admin_auth != "user")
				{
				?>
				<span align="center"><div class='btWwhite_s'><a href="../wp_player_ctrl/index.html?mode=view&pla_id=<?=$obj->pla_id?>"><span style="font-size:8pt;">보기</span></a></div></span>

				
				<?
				}
				?>
			</td>
		</tr>
		<?
			$article_num--;
		}//for
		?>
		</tbody>
		</table>
	</td>
</tr>
<tr>
	<td align="center">
		<? require_once "../wp_object/page_move.html";?>
	</td>
</tr>
</table>
</form>