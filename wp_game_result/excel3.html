<?
header("Content-type: application/vnd.ms-excel");
header("Content-Disposition: attachment; filename=경기실적 기록용지.xls");
header("Content-Description: PHP4 Generated Data");

// Session 시작 //
session_start();

// Mysql 클래스 //
require_once "../wp_library/mysql_class.php";
// DB 생성 //
$Mysql = new Mysql;
// DB 연결 //
$Mysql->Connect();

// Setup 설정 //
require_once "../wp_library/setup.php";

// Paging 클래스 //
require_once "../wp_library/page_class.php";

// Error 함수 //
require_once "../wp_library/check.php";

?>
<table width="100%" border="1" cellspacing="0" cellpadding="0">
	<tr>
		<!--
		<th width="5%">번호</th>
		-->
		<th width="6%">시/군</th>
		<th width="6%">선수명</th>
		<th width="3%">순위</th>
		<th width="3%">기록</th>
		<th width="6%">경기구분</th>
		<th>종목</th>
		<th>장애등급</th>
	</tr>
	<?
	//ORDER BY절 생성
	//출력순
	if($spo_code == "POWERLIFTING")
	{
		$orderby .= "game_code ASC, spo_sec_code ASC,";
	}

	if(!$orderby1 && !$orderby2 && !$orderby3 && !$orderby4)
		$orderby .= " game_code ASC, rank_tot ASC,";
	if($orderby1)
		$orderby .= " $orderby1 ASC, ";
	if($orderby2)
		$orderby .= " $orderby2 ASC, ";
	if($orderby3)
		$orderby .= " $orderby3 ASC, ";
	if($orderby4)
		$orderby .= " $orderby4 ASC, ";
	$orderby .= " uid desc ";

	//WHERE절 생성 //
	$where = " WHERE gam_uid='$s_gam_uid' ";

	//경기번호
	if($game_code)
	{
		$where .= " AND  game_code = '$game_code'";
	}
	//시/군선택
	if($clu_code) $where .= " AND clu_code='$clu_code'";
	//종목선택
	if($spo_code) $where .= " AND spo_code='$spo_code'";
	//2차종목선택
	if($spo_sec_code) $where .= " AND spo_sec_code='$spo_sec_code'";
	//순위 입상자만.
	if($rank) $where .= " AND rank_tot in(1,2,3) ";
	//시범경기제외
	if($test_game == "1") $where .= " AND test_game <> '1' ";
	//시범경기만
	if($test_game1 == "1") $where .= " AND test_game = '1' ";
	//기권자만
	if($giveup == "1"){
		$where .= " AND (record_tot is null or record_tot in ('-','','0')) ";
	}
	if(eregi("[^[:space:]]+",$key))
		$where .= " AND  $keyfield LIKE '%$key%' ";

	// 레코드 쿼리 //
	$query = "SELECT * FROM wp_game_record $where ORDER BY $orderby  ";
	//echo $query;
	$result = mysql_query($query);
	if(!$result)
	{
		Error("QUERY_ERROR");
		exit;
	}

	$article_num = mysql_num_rows($result);

	// 종목 한글 이름 검색 //
	$gn_que = "SELECT * FROM wp_game_serial WHERE gam_uid = '$s_gam_uid'";
	$gn_res = mysql_query($gn_que);
	while($gn_obj = mysql_fetch_object($gn_res))
	{
		$game_name_code[$gn_obj->game_code] = $gn_obj->game_name;
	}

	// 이전 게임의 게임번호를 가지는 변수 //
	$ex_game_code = "";

	// 레코드 결과 //
	while($obj = mysql_fetch_object($result))
	{
		//echo $obj->game_code;
		$my_spo_sec_code = getSpo_sec_code($obj->spo_code, $obj->spo_sec_code);
		$signdate_d = date('Y.m.d',$obj->signdate);

		$my_game_code = $obj->game_code;

		if($obj->rank_tot =="" || $obj->rank_tot =="0") $my_rank = "";
		else $my_rank = $obj->rank_tot."위";

		$my_spo_txt = "";
		if($obj->spo_code == "ATHIETICS"){
			$my_spo_code = $wp_sports_code[$obj->spo_code]." ".$my_spo_sec_code;
		}
		else
		{
			$my_spo_code = $wp_sports_code[$obj->spo_code];
		}
		$my_spo_code_detail = $wp_sports_detail_code[$obj->spo_code_detail];
		$my_tro_level = $wp_trouble_code[$obj->tro_code]."[".$obj->tro_level_code."]";
	//	$my_spo_txt = $wp_sports_code[$obj->spo_code]."|".$my_spo_sec_code."|".$wp_sports_detail_code[$obj->spo_code_detail]."|".$wp_trouble_code[$obj->tro_code]."|".$obj->tro_level_code;

		if($obj->test_game) $game_info = "시범경기";
		else $game_info = "";

		// 경기 기록 입력 //
		if(in_array($obj->spo_code,$wp_tot_game) && in_array($obj->spo_code,$wp_real_game))
		{
			$my_tot_result = $obj->record_tot;
		}
		else if(in_array($obj->spo_code,$wp_score_game))
		{
			if($obj->spo_code == "POWERLIFTING")
			{
				if($obj->spo_sec_code == "PL300" || $obj->spo_sec_code == "PL600")
				{
					$my_tot_result = ($obj->record_01+$obj->record_02)."kg";
				}
				else
				{
					$my_tot_result = $obj->record_tot."kg";
				}
			}
			else if($obj->spo_code == "ATHIETICS" || $obj->spo_code == "ROWING" || $obj->spo_code == "SWIMMING")
			{
				if($obj->spo_sec_code == "AS200")
				{
					if($obj->game_code == "ATHIETICS_AS200-43" || $obj->game_code == "ATHIETICS_AS200-44" || $obj->game_code == "ATHIETICS_AS200-45" || $obj->game_code == "ATHIETICS_AS200-46" || $obj->game_code == "ATHIETICS_AS200-47" || $obj->game_code == "ATHIETICS_AS200-49")
					{
						$my_conv = $obj->record_tot*0.01;
						$my_tot_result = $my_conv."M";
					}
					else
					{
						$my_tot_result = $obj->record_tot."M";
					}
				}
				else
				{
					//멀리뛰기 트랙이지만 단위는 M	 2019.03
					if($obj->game_code == "ATHIETICS_AS100-53" || $obj->game_code == "ATHIETICS_AS100-54" || $obj->game_code == "ATHIETICS_AS100-55" || $obj->game_code == "ATHIETICS_AS100-56")
                    {
						$my_tot_result = $obj->record_tot."M";
					}
					else
					{
						$my_tot_result = $obj->record_tot."초";
					}
					
					  //$my_tot_result = $obj->record_tot."초";
				}
			}
			else
			{
				$my_tot_result = $obj->record_tot."점";
			}
		}
		else
		{
			$my_tot_result = $obj->record_tot."점";
		}
	if($ex_game_code != $obj->game_code)
	{
		echo "<tr><td colspan='7' align='left' style='mso-number-format:\"\@\";' >".$game_name_code[$obj->game_code]."</td></tr>";
		$ex_game_code = $obj->game_code;
	}
	?>
	<tr <?=$bgcolor?>>
		<!-- 번호
		<td align="center" style='mso-number-format:"\@";' ><?=$article_num?></td>
		-->
		<td align="center" style='mso-number-format:"\@";' ><?=$wp_club_code[$obj->clu_code]?></td>
		<td align="center" style='mso-number-format:"\@";' ><?=$obj->name?></td>
		<td align="center" style='mso-number-format:"\@";' ><?=$my_rank?>
			<?
			/*
			if(!$obj->rank)
			{
				if($obj->game_code == "ATHIETICS_AS100-01")
				{
					echo "5위";
				}
				else if($obj->game_code == "ATHIETICS_AS100-15" || $obj->game_code == "ATHIETICS_AS100-31")
				{
					echo "3위";
				}
				else if($obj->game_code == "ATHIETICS_AS100-26")
				{
					echo "2위";
				}
				else if($obj->game_code == "ATHIETICS_AS100-30" || $obj->game_code == "ATHIETICS_AS100-02" || $obj->game_code == "ATHIETICS_AS100-35" || $obj->game_code == "ATHIETICS_AS100-38")
				{
					echo "1위";
				}
				else
				{
					echo "4위";
				}
			}
			else
			{
				echo $my_rank;
			}
			*/
			?>
		</td>
		<td align="center" style='mso-number-format:"\@";' >
			<?
			if($obj->spo_code == "BOWLING" || $obj->spo_sec_code == "AS200")
			{
				echo "
				<table>
				<tr>
					<td align='center' style='mso-number-format:\"\@\";' >$obj->record_01</td>
					<td align='center' style='mso-number-format:\"\@\";' >$obj->record_02</td>
					<td align='center' style='mso-number-format:\"\@\";' >$obj->record_03</td>
					<td align='center' style='mso-number-format:\"\@\";' >$my_tot_result</td>
				</tr>
				</table>
				";
			}
			else
			{
				echo "$my_tot_result";
			}
			?>
		</td>
		<td align="center" style='mso-number-format:"\@";' >
			<?
			if($obj->spo_code == "POWERLIFTING")
			{
				if($obj->spo_sec_code == "PL100")
				{
					$lift_title = "파워리프팅";
					echo $lift_title;
				}
				else if($obj->spo_sec_code == "PL200")
				{
					$lift_title = "웨이트리프팅";
					echo $lift_title;
				}
				else if($obj->spo_sec_code == "PL300")
				{
					$lift_title = "벤치프레스 종합";
					echo $lift_title;
				}
				else if($obj->spo_sec_code == "PL400")
				{
					$lift_title = "스쿼트";
					echo $lift_title;
				}
				else if($obj->spo_sec_code == "PL500")
				{
					$lift_title = "데드리프팅";
					echo $lift_title;
				}
				else if($obj->spo_sec_code == "PL600")
				{
					$lift_title = "파워리프팅 종합";
					echo $lift_title;
				}

			}
			else
			{
				echo $game_info;
			}
			?>
		</td>
		<td align="center" style='mso-number-format:"\@";' ><?=$my_spo_code?></td>
		<td align="center" style='mso-number-format:"\@";' ><?=$my_tro_level?></td>
	</tr>
	<?
		unset($my_rank);
		unset($my_clu_code);
		unset($my_spo_sec_code);
		unset($my_spo_code_detail);
		$article_num--;
	}//for
?>
</table>

