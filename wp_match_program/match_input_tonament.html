<!-- Document Start -->
<table width="100%" height="700" border="0" cellspacing="0" cellpadding="0">
<tr>
	<td valign="top" align="center">
		<?
		$s_que = "SELECT *, group_concat(spo_code_detail order by spo_code_detail ASC separator '/') spo_code_details FROM wp_game_serial WHERE gam_uid='$s_gam_uid' AND game_code = '$game_code' GROUP BY game_code";
		$s_res = mysql_query($s_que);
		$s_obj = mysql_fetch_object($s_res);
		$s_tmp = explode("/",$s_obj->spo_code_details);
		$my_spo_code_details = "'";
		foreach($s_tmp as $keys => $vals)
		{
			$my_spo_code_details .= $vals."','";
		}
		$my_spo_code_details = substr($my_spo_code_details, 0 ,strlen($my_spo_code_details) - 2);
		//시범경기
		unset($my_test_game);
		if($s_obj->test_game == "1") $my_test_game = "<font color='#0000ff'>[미성립 세부경기]</font>";


  /* 2016년 5월 2일 수정 여자 개인전 BIS, BIW 통합 이었는데 2017년 대회는 분리 됨
  if($game_code == "BILLIARDS_BA100-03" || $game_code == "BILLIARDS_BA100-04")
	{
		$where = " WHERE gam_uid='$s_gam_uid' AND spo_code='$s_obj->spo_code' AND spo_sec_code='$s_obj->spo_sec_code' AND sex='$s_obj->sex' AND (tro_level_code = 'BIS' OR tro_level_code = 'BIW') AND spo_code_detail in ($my_spo_code_details)"; */



		$where = " WHERE gam_uid='$s_gam_uid' AND spo_code='$s_obj->spo_code' AND sex='$s_obj->sex' AND tro_level_code = '$s_obj->tro_level_code' AND spo_code_detail in ($my_spo_code_details)";

		//$where = " WHERE gam_uid='$s_gam_uid' AND spo_code='$s_obj->spo_code' AND spo_sec_code='$s_obj->spo_sec_code' AND sex='$s_obj->sex' AND tro_level_code = //'$s_obj->tro_level_code' AND spo_code_detail in ($my_spo_code_details)";
		//$orderby = " ORDER BY clu_class_name asc, spo_code ASC, spo_sec_code ASC, spo_code_detail ASC, tro_code ASC, sex ASC, tro_level_code ASC, pla_name ASC";

	

		
		
		
		//종목별 토너먼트 갯수 구하기
		$orderby = " ORDER BY clu_class_name ASC, pla_name ASC";

		// 단체전(시/군)이면
		if($game_kind == "3")
		{
			$tot_que = "SELECT *,group_concat(pla_name order by spo_code_detail ASC, pla_name ASC separator ',') pla_name  FROM wp_game_player $where GROUP BY clu_code $orderby";
		}
		else if($game_kind == "2") // 단체전
		{
			$tot_que = "SELECT *,group_concat(pla_name order by spo_code_detail ASC, pla_name ASC separator ',') pla_name  FROM wp_game_player $where GROUP BY clu_code, spo_code_detail,group_str $orderby";
		}
		else
		{
			$tot_que = "SELECT * FROM wp_game_player $where GROUP BY clu_code,pla_id $orderby";
		}
	

	    /* 2019-04-29 일 테니스 복식이 개인전으로 보이는 현상 해결 */
		if($s_obj->game_code == "TENNIS_TS100-03" || $s_obj->game_code == "TENNIS_TS100-04" || $s_obj->game_code == "TENNIS_TS100-06" || $s_obj->game_code == "TENNIS_TS100-08")
		{
			$tot_que = "SELECT *,group_concat(pla_name order by spo_code_detail ASC, pla_name ASC separator ',') pla_name  FROM wp_game_player $where GROUP BY clu_code, spo_code_detail $orderby";
		}
		
		
		$tot_res = mysql_query($tot_que);
		$match_person = mysql_num_rows($tot_res);
		$match_player = array();


        

		while($tot_obj = mysql_fetch_object($tot_res))
		{
			$match_player[$tot_obj->pla_id] =$tot_obj->clu_class_name." ".$tot_obj->pla_name;
		}

		if($match_person >=1 && $match_person <= 4) $match_cnt = 2;
		if($match_person >=5 && $match_person <= 8) $match_cnt = 4;
		if($match_person >=9 && $match_person <= 16) $match_cnt = 8;
		if($match_person >=17 && $match_person <= 32) $match_cnt = 16;
		if($match_person >=33 && $match_person <= 64) $match_cnt = 32;


		//바둑 리그후 대진작성 - 한쪽라인 명수 16강이면 한쪽이 8, 8강이면 4, 4강이면 2
	    if($game_code == 'BADUK_BD100-01') $match_cnt = 8;
		if($game_code == 'BADUK_BD100-02') $match_cnt = 2;
		if($game_code == 'BADUK_BD100-04') $match_cnt = 2; 

        //보치아 리그후 대진작성 2019년
		if($game_code == 'BOCCIA_BC100-02') $match_cnt = 4; 
		if($game_code == 'BOCCIA_BC100-03') $match_cnt = 4;
		if($game_code == 'BOCCIA_BC100-04') $match_cnt = 2;


		?>
		<form name="signForm" action="match_input.php?gam_uid=<?=$gam_uid?>&game_code=<?=$game_code?>&spo_code=<?=$s_obj->spo_code?>&spo_sec_code=<?=$s_obj->spo_sec_code?>&spo_code_detail=<?=$s_obj->spo_code_detail?>&match_cnt=<?=$match_cnt?>&test_game=<?=$s_obj->test_game?>&game_kind=<?=$game_kind?>" method="post">
		<table width="750" border="0" cellpadding="3" cellspacing="1" bgcolor="#cacaca">
		<tr bgcolor="#ffffff">
			<td style="padding-top:20px" colspan="5">
				<b><u>종목 : <?=$s_obj->game_name?> (<?=$match_person?>) <?=$my_test_game?></u> | 게임번호 : <?=$game_code?></b>
			</td>
		</tr>
		<?
		$left_num = 1;
		$right_num = (2*$match_cnt);
		//$person_cnt = $right_num;


        //2018년 26회 여수대회 론볼2경기, 테니스 14경기 표준대진표와 달라 추가함.
		//if($game_code == 'TABLETENNIS_TT200-14') $match_person = 91;
		                                         //if($game_code == 'LAWNBOWL_LB100-02') $match_person = 92; //2019년 다시 원상 복귀로 주석처리 함

		//바둑 리그후 대진작성
	    if($game_code == 'BADUK_BD100-01') $match_person = 93;
	    if($game_code == 'BADUK_BD100-02') $match_person = 4;
	    if($game_code == 'BADUK_BD100-04') $match_person = 4;

        //보치아 리그후 대진작성 2019년
		if($game_code == 'BOCCIA_BC100-02') $match_person = 6; 
		if($game_code == 'BOCCIA_BC100-03') $match_person = 5;
		if($game_code == 'BOCCIA_BC100-04') $match_person = 4;

		//테니스 
		if($game_code == 'TENNIS_TS100-03') $match_person = 4;



		$bye_num = array();
		$query = "SELECT * FROM wp_match_program WHERE match_person = '$match_person' limit 1";

		$result = mysql_query($query);
		if(mysql_num_rows($result) > 0)
		{
			$obj = mysql_fetch_object($result);
			$bye_num = explode(":", $obj->bye);
		}

		// 기존에 등록된 데이터 검색
		$level = $match_cnt * 2;
		$al_player = array();
		$al_que = "SELECT * FROM wp_game_record WHERE gam_uid = '$gam_uid' AND game_code='$game_code' AND level='$level' ORDER BY lane_no";
		$al_res = mysql_query($al_que);
		while($al_obj = mysql_fetch_object($al_res))
		{

			$al_player[] = $al_obj->lane_no."/".$al_obj->id;
		}

		// 토너먼트 표 작성
		$p_cnt = 0;
		for ( $i=1; $i<= $match_cnt; $i++)
		{
			echo "
			<tr bgcolor='#ffffff'>
				<td width='10%' align='right'>$left_num : </td>
				<td width='15%' align='center'>
			";
				if(in_array($left_num, $bye_num))
				{
					echo "BYE";
				}
				else
				{

					echo "<select name='p_$left_num'>";
					foreach($match_player as $key_f => $val_f)
					{
						unset($is_choice);
						if(in_array($left_num."/".$key_f, $al_player)) $is_choice = " selected";
						echo "<option value='$key_f' $is_choice>$val_f</option>";
					}
					echo "</select>";
				}
			echo "</td>
				<td></td>
				<td width='10%' align='right'>$right_num : </td>
				<td width='15%' align='center'>
			";
				if(in_array($right_num, $bye_num))
				{
					echo "BYE";
				}
				else
				{
					echo "<select name='p_$right_num'>";
					foreach($match_player as $key_f => $val_f)
					{
						unset($is_choice);
						if(in_array($right_num."/".$key_f, $al_player)) $is_choice = " selected";
						echo "<option value='$key_f' $is_choice>$val_f</option>";
					}
					echo "</select>";
				}
			echo "</td>
			</tr>
			";
			$left_num++;
			$right_num--;
		}
		?>
		<tr bgcolor='#ffffff'>
			<td colspan="5" align="center"><input type="submit" name="sch" value="대진표등록" class="btnBox3" style="width:150; height:25;font-size:12pt"></td>
		</tr>
		</table>
		</form>
	</td>
</tr>
</table>
<!-- Document End -->
