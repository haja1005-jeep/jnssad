<?
header("Content-type: application/vnd.ms-excel");
header("Content-Disposition: attachment; filename=시군별총득점현황.xls");
header("Content-Description: PHP4 Generated Data");

// Session 시작 //
session_start();

// Mysql 클래스 //
require_once "../wp_library/mysql_class.php";
// DB 생성 //
$Mysql = new Mysql;
// DB 연결 //
$Mysql->Connect();

// Setup 설정 //
require_once "../wp_library/setup.php";

?>
<body>
<p style="font-size:15px; font-weight:bold;"><?=$wp_games[$gam_uid]?>시군별 총득점현황</p>
<table border=1>
	<tbody>
	<tr>
		<th rowspan="2">시/군</th>
		<th colspan="2">결과</th>
		<th>기본점수</th>
		<th>개최지가산점</th>
		<th colspan="15">정식종목</th>
		<th colspan="6">시범종목</th>
	</tr>
	<tr>
		<th width="5%">총순위</th>
		<th width="5%">총합계</th>
		<th width="5%">참가인원</th>
		<th width="5%">영암군(20%)</th>
		<th>골볼</th>
		<th>당구</th>
		<th>론볼</th>
		<th>좌식배구</th>
		<th>배드민턴</th>
		<th>보치아</th>
		<th>수영</th>
		<th>볼링</th>
		<th>역도</th>
		<th>육상</th>
		<th>실내조정</th>
		<th>축구</th>
		<th>탁구</th>
		<th>게이트볼</th>
		<th>바둑</th>
		<th>파크골프</th>
		<th>펜싱</th>
		<th>테니스</th>
		<th>승마</th>
		<th>댄스스포츠</th>
		<th>양궁</th>
	</tr>

	<?

	// 시/군의 총득점 순위 검색
	$rank_que = "SELECT clu_code, sum(score) score FROM wp_score WHERE gam_uid = '$s_gam_uid' GROUP BY clu_code ORDER BY sum(score) desc ";
	$rank_res = mysql_query($rank_que);
	$rank_city = array();
	while($rank_obj = mysql_fetch_object($rank_res))
	{
		$rank_city[$rank_obj->clu_code] = $rank_obj->score;
	}

	$rank = 1;
	$tr_cnt = 1;
	foreach($rank_city as $keys => $vals)
	{

		// 전년도 시/군별 득점현황 검색
		$b_score_que = "SELECT clu_code,spo_code, sum(score) score FROM wp_score WHERE clu_code = '$keys' AND gam_uid='$before_gam_uid' GROUP BY clu_code, spo_code";
		$b_score_res = mysql_query($b_score_que);
		$b_city_score = array();
		while($b_score_obj = mysql_fetch_object($b_score_res))
		{
			$b_city_score[$b_score_obj->spo_code] = $b_score_obj->score;
		}
		
		// 전년도 총합계
		$b_rank_que = "SELECT clu_code, sum(score) score FROM wp_score WHERE gam_uid = '$before_gam_uid' AND clu_code = '$keys' ";
		$b_rank_res = mysql_query($b_rank_que);
		$b_rank_obj = mysql_fetch_object($b_rank_res);

		echo "<tr id='b_$tr_cnt' style='display:nones; background:#e6e6e6'>";

		// 시/군
		echo "<td align='center' style='background:white;' rowspan='2'>".$wp_club_code[$keys]."</td>";

		// 총순위
		echo "<td align='center'>전년도</td>";

		// 총합계
		echo "<td align='center'>".number_format($b_rank_obj->score)."</td>";
		
		// 참가점수
		echo "<td align='center'>".$b_city_score[참가점수]."</td>";

		// 가산점
		echo "<td align='center'></td>";

		// 전년도 종목별점수
		echo "<td align='center'>".number_format($b_city_score[GOALBALL])."</td>";
		echo "<td align='center'>".number_format($b_city_score[BILLIARDS])."</td>";
		echo "<td align='center'>".number_format($b_city_score[LAWNBOWL])."</td>";
		echo "<td align='center'>".number_format($b_city_score[VOLLEYBALL])."</td>";
		echo "<td align='center'>".number_format($b_city_score[BADMINTON])."</td>";
		echo "<td align='center'>".number_format($b_city_score[BOCCIA])."</td>";
		echo "<td align='center'>".number_format($b_city_score[SWIMMING])."</td>";
		echo "<td align='center'>".number_format($b_city_score[BOWLING])."</td>";
		echo "<td align='center'>".number_format($b_city_score[POWERLIFTING])."</td>";
		echo "<td align='center'>".number_format($b_city_score[ATHIETICS])."</td>";
		echo "<td align='center'>".number_format($b_city_score[ROWING])."</td>";
		echo "<td align='center'>".number_format($b_city_score[FOOTSAL])."</td>";
		echo "<td align='center'>".number_format($b_city_score[TABLETENNIS])."</td>";
		echo "<td align='center'>".number_format($b_city_score[GATEBALL])."</td>";
		echo "<td align='center'>".number_format($b_city_score[BADUK])."</td>";
		echo "<td align='center'>".number_format($b_city_score[GOLF])."</td>";
		echo "<td align='center'>".number_format($b_city_score[FENCING])."</td>";
		echo "<td align='center'>".number_format($b_city_score[TENNIS])."</td>";
		echo "<td align='center'>".number_format($b_city_score[HORSERIDING])."</td>";
		echo "<td align='center'>".number_format($b_city_score[DANCE])."</td>";
		echo "<td align='center'>".number_format($b_city_score[ARCHERY])."</td>";
		echo "</tr>";

		$tr_cnt++;
		
		
		$score_que = "SELECT clu_code,spo_code, sum(score) score FROM wp_score WHERE clu_code = '$keys' AND gam_uid='$s_gam_uid' GROUP BY clu_code, spo_code";
		$score_res = mysql_query($score_que);
		$city_score = array();
		while($score_obj = mysql_fetch_object($score_res))
		{
			$city_score[$score_obj->spo_code] = $score_obj->score;
		}

		echo "<tr>";

		// 시/군
//			echo "<td align='center'>".$wp_club_code[$keys]."</td>";

		// 총순위
		echo "<td align='center'>$rank</td>";

		// 총합계
		echo "<td align='center'>".number_format($vals)."</td>";
		
		// 참가점수
		echo "<td align='center'>".$city_score[참가점수]."</td>";

		// 가산점
		unset($add_score);
		if($game_city_code == $keys) number_format($add_score = $city_score[가산점]);
		echo "<td align='center'>$add_score</td>";

		// 종목별점수
		unset($updown);
		if($city_score[GOALBALL] > $b_city_score[GOALBALL]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[GOALBALL] < $b_city_score[GOALBALL] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[GOALBALL])."</td>";

		unset($updown);
		if($city_score[BILLIARDS] > $b_city_score[BILLIARDS]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[BILLIARDS] < $b_city_score[BILLIARDS] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[BILLIARDS])."</td>";

		unset($updown);
		if($city_score[LAWNBOWL] > $b_city_score[LAWNBOWL]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[LAWNBOWL] < $b_city_score[LAWNBOWL] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[LAWNBOWL])."</td>";

		unset($updown);
		if($city_score[VOLLEYBALL] > $b_city_score[VOLLEYBALL]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[VOLLEYBALL] < $b_city_score[VOLLEYBALL] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[VOLLEYBALL])."</td>";

		unset($updown);
		if($city_score[BADMINTON] > $b_city_score[BADMINTON]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[BADMINTON] < $b_city_score[BADMINTON] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[BADMINTON])."</td>";

		unset($updown);
		if($city_score[BOCCIA] > $b_city_score[BOCCIA]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[BOCCIA] < $b_city_score[BOCCIA] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[BOCCIA])."</td>";

		unset($updown);
		if($city_score[SWIMMING] > $b_city_score[SWIMMING]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[SWIMMING] < $b_city_score[SWIMMING] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[SWIMMING])."</td>";

		unset($updown);
		if($city_score[BOWLING] > $b_city_score[BOWLING]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[BOWLING] < $b_city_score[BOWLING] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[BOWLING])."</td>";

		unset($updown);
		if($city_score[POWERLIFTING] > $b_city_score[POWERLIFTING]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[POWERLIFTING] < $b_city_score[POWERLIFTING] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[POWERLIFTING])."</td>";

		unset($updown);
		if($city_score[ATHIETICS] > $b_city_score[ATHIETICS]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[ATHIETICS] < $b_city_score[ATHIETICS] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[ATHIETICS])."</td>";

		unset($updown);
		if($city_score[ROWING] > $b_city_score[ROWING]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[ROWING] < $b_city_score[ROWING] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[ROWING])."</td>";

		unset($updown);
		if($city_score[FOOTSAL] > $b_city_score[FOOTSAL]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[FOOTSAL] < $b_city_score[FOOTSAL] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[FOOTSAL])."</td>";

		unset($updown);
		if($city_score[TABLETENNIS] > $b_city_score[TABLETENNIS]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[TABLETENNIS] < $b_city_score[TABLETENNIS] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[TABLETENNIS])."</td>";

		unset($updown);
		if($city_score[GATEBALL] > $b_city_score[GATEBALL]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[GATEBALL] < $b_city_score[GATEBALL] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[GATEBALL])."</td>";

		unset($updown);
		if($city_score[BADUK] > $b_city_score[BADUK]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[BADUK] < $b_city_score[BADUK] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[BADUK])."</td>";

		unset($updown);
		if($city_score[GOLF] > $b_city_score[GOLF]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[GOLF] < $b_city_score[GOLF] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[GOLF])."</td>";

		unset($updown);
		if($city_score[FENCING] > $b_city_score[FENCING]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[FENCING] < $b_city_score[FENCING] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[FENCING])."</td>";

		unset($updown);
		if($city_score[TENNIS] > $b_city_score[TENNIS]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[TENNIS] < $b_city_score[TENNIS] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[TENNIS])."</td>";


		unset($updown);
		if($city_score[HORSERIDING] > $b_city_score[HORSERIDING]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[HORSERIDING] < $b_city_score[HORSERIDING] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[HORSERIDING])."</td>";
	

		unset($updown);
		if($city_score[DANCE] > $b_city_score[DANCE]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[DANCE] < $b_city_score[DANCE] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[DANCE])."</td>";
	

		unset($updown);
		if($city_score[ARCHERY] > $b_city_score[ARCHERY]) $updown = "<span style='font-size:15px; font-weight:bold;color:blue'>▲</span>";
		else if($city_score[ARCHERY] < $b_city_score[ARCHERY] ) $updown = "<span style='font-size:15px; font-weight:bold;color:red'>▼</span>";
		echo "<td align='center'>$updown".number_format($city_score[ARCHERY])."</td>";
		echo "</tr>";

		$rank++;

	}

	$tot_que = "SELECT spo_code, sum(score) score FROM wp_score WHERE gam_uid = '$s_gam_uid' GROUP BY spo_code ";
	$tot_res = mysql_query($tot_que);
	$total_score = array();
	$all_score = 0; // 총점수
	while($tot_obj = mysql_fetch_object($tot_res))
	{
		$total_score[$tot_obj->spo_code] = $tot_obj->score;
		if($tot_obj->spo_code != "가산점")
		{
			$all_score += $tot_obj->score;
		}
	}
	?>

	<tr>
		<th colspan="2">총계</th>
		<th><?=number_format($all_score)?></th>
		<th><?=number_format($total_score['참가점수'])?></th>
		<th><?=$add_score?></th>
		<th><?=number_format($total_score[GOALBALL])?></th>
		<th><?=number_format($total_score[BILLIARDS])?></th>
		<th><?=number_format($total_score[LAWNBOWL])?></th>
		<th><?=number_format($total_score[VOLLEYBALL])?></th>
		<th><?=number_format($total_score[BADMINTON])?></th>
		<th><?=number_format($total_score[BOCCIA])?></th>
		<th><?=number_format($total_score[SWIMMING])?></th>
		<th><?=number_format($total_score[BOWLING])?></th>
		<th><?=number_format($total_score[POWERLIFTING])?></th>
		<th><?=number_format($total_score[ATHIETICS])?></th>
		<th><?=number_format($total_score[ROWING])?></th>
		<th><?=number_format($total_score[FOOTSAL])?></th>
		<th><?=number_format($total_score[TABLETENNIS])?></th>
		<th><?=number_format($total_score[GATEBALL])?></th>
		<th><?=number_format($total_score[BADUK])?></th>
		<th><?=number_format($total_score[GOLF])?></th>
		<th><?=number_format($total_score[FENCING])?></th>
		<th><?=number_format($total_score[TENNIS])?></th>
		<th><?=number_format($total_score[HORSERIDING])?></th>
		<th><?=number_format($total_score[DANCE])?></th>
		<th><?=number_format($total_score[ARCHERY])?></th>
	</tr>
</table>
</body>